---
title: "Projet HAB904B"
author: "Basile Pajot, Marion Themeze--Leroy,"
date: "`r Sys.Date()`"
output: 
  pdf_document : 
    number_sections: TRUE
    toc : TRUE 
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r echo=FALSE}
# Chargement des pakages nécessaires
library(tidyverse)
library(cowplot)
library(R2jags)
library(lme4)
library(gtsummary)
```


```{r echo=FALSE}
# Importation du fichier 
gopher <- read.csv(file = "./gopher.csv", header = TRUE, sep = ";", dec=".", stringsAsFactors = TRUE)
gopher$year<-as.factor(gopher$year)
gopher$total_turtle<-gopher$Area*gopher$density
summary(gopher)
str(gopher)
view(gopher)
```

# **Lecture et exploration des données**

## La variable à expliquer

La variable d'intérêt à expliquer, est `Shells`, soit le nombre de carapaces de 
tortues trouvées lors des relevés sur le terrain. Cette variable est un proxy pour estimer le nombre de tortues mortes. 
Nous voulons déterminer si : 
- le nombre de carapaces to establish whether either (1) the number of shell remains found was correlated with seroprevalence in a given site and year or (2) the number of shell remains found was greater in high- than in low-prevalence sites.

## Les variables explicatives d'intérêt

-  `Prev` est une variable explicative qualitative qui correspond au taux de tortues séropostives pour à *Mycoplasma agassizii*. 

- `Site` est une variable qualitative qui correspond au sité d'étude où ont été faits les relevés. Elle a 10 modalités : 
le parc national *Big Shoals (BS)*, l'aire de gestion de la faune sauvage *Camp Blanding (CB)*, l'aire de gestion de la faune sauvage et de l'environnement *Cecil Field/Branan Field (CF)*, une *propriété privé en Floride centrale (CE)*, le parc national *Fort Cooper (FC)*, l'aire de gestion de la faune sauvage *Flying Eagle (FE)*, le parc national *Gold Head Branch (GH)*, l'aire de gestion de la faune sauvage et de l'environnement *Perry Oldenburg (OL)*,la station biologique *Ordway-Swisher (OR)*, l'aire de gestion de la pêche *Tenoroc Fish (TE)*.

-  `Area` est une variable quantitative qui correspond à l'aire couverte par site lors des relevés. 

-  `Year` est une variable qualitative qui correspond à l'année pour laquelle les relevés ont été faits. Ella a 3 modalités : 2004, 2005, 2006. 


Lisez les données, et assurez vous que les variables sont au bon format. Calculez des statistiques descriptives des données, et proposez des visualisations graphiques. Commentez ce que vous retenez de l'exploration des données.

```{r echo=FALSE}
F1<- ggplot(gopher, aes(x=year, y=shells, fill=year)) +
  geom_boxplot() +
  labs(caption= "Figure 1 : Le nombre de carapaces en fonction de l'année",
       x = "Année") +
  theme(plot.caption = element_text(hjust = 0, face = "italic", size = 12))
F2<- ggplot(gopher, aes(x=Site, y=shells, fill=Site)) +
  geom_boxplot() +
  labs(caption= "Figure 2 : Le nombre de carapaces en fonction du site",
       x = "Site") +
  theme(plot.caption = element_text(hjust = 0, face = "italic", size = 12))

plot_grid(nrow=1, ncol=2,
          F1,
          F2)
```

Le nombre de carapaces de tortues mortes varie en fonction des année et du site d'étude. Ainsi, ces deux 
```{r echo=FALSE}
ggplot(gopher, aes(x=Area, y=shells)) +
  geom_point()
```

```{r echo=FALSE}
ggplot(gopher, aes(x=prev, y=shells,color=Site, shape=year)) +
  geom_point() +
  facet_wrap(~Site)+
  labs(caption= "Figure 1 : Le nombre de carapaces en fonction de la prevalence de tortues séropositives dans la zone d'étude, par site par année",
       x = "Prévalence de tortues séropositives à Mycoplasma agassizii",
       y= "Carapaces de tortues") +
  theme(plot.caption = element_text(hjust = 0, face = "italic", size = 12))
```


La prévalence diffère en fonction des sites (Fig 1). 
Pour un même site


```{r echo=FALSE}
ggplot(gopher, aes(x=year, y=shells, color=Site)) +
  geom_point() +
  facet_wrap(~Site)+
  labs(caption= "Figure 2 : Le nombre de carapaces en fonction de l'année et du site d'étude",
       x = "Année") +
  theme(plot.caption = element_text(hjust = 0, face = "italic", size = 12))
```



```{r echo=FALSE}
ggplot(gopher, aes(x=year, y=prev,color=Site)) +
  geom_point() +
  facet_wrap(~Site)+
  labs(caption= "Figure 1 : Le nombre de carapaces en fonction de l'année et du site d'étude",
       x = "Année") +
  theme(plot.caption = element_text(hjust = 0, face = "italic", size = 12))
```

```{r echo=FALSE}
ggplot(gopher, aes(x=density, y=prev,color=Site)) +
  geom_point() +
  geom_jitter(width = 0.06) +
  facet_wrap(~Site)+
  labs(caption= "Figure 1 : La prevalence de séropositifs en fonction de la densité de tortues trouvées dans la zone",
       x = "Area") +
  theme(plot.caption = element_text(hjust = 0, face = "italic", size = 12))
```


Graphique qui expliaue pourquoi site en aléatoire 
Année pourrait être en aléatoire mais pour simplifier on ne le mets pas et donc on estime un coefficient par année
Motrer que nombre carapces hange en fonciton preval
Un graphique pour justififer l'offset 


```{r echo=FALSE}
tbl_summary(gopher, statistic = list(all_continuous() ~ "{N_obs}({min})({max})({mean})({median})({sd})"))
table()
```

```{r echo=FALSE, fig.height=7.5, fig.width=14}
# D'abord, on définit les graphiques
p_1 <- ggplot(L, aes(x=, y=, fill=)) + 
  geom_boxplot() + 
  labs(x="", fill = "", caption = "") + 
  theme(plot.caption = element_text(hjust = 0, face = "italic", size = 14))

p_2 <- ggplot(Limosa, aes(x=fPeriod, y=IntakeRate,fill= fPeriod)) + 
  geom_boxplot() + 
  labs(x="", fill = "", caption = "") + 
  theme(plot.caption = element_text(hjust = 0, face = "italic", size = 14))

# Puis on les organise dans l'espace
plot_grid(nrow=1, ncol=2,
          p_1,
          p_2)
```
# **Ajustement d'un modèle simple**
Une analyse statistique passe toujours par l'ajustement d'un premier modèle simple. Commencez par décrire le modèle qui vous semble pertinent pour répondre à une des questions traitées dans l'article, en vous aidant d'équations ou pas, et en justifiant son utilisation. Rappelez les hypothèses sur lesquelles repose le modèle. Notez qu'il ne vous est pas demandé de vérifier la validité de ces hypothèses (l'analyse des résidus). Vous pouvez ignorer les effets aléatoires sur les pentes (slopes) et ne considérer que des modèles avec un effet aléatoire sur l'ordonnée à l'origine (intercept).

$Y_{ijk}$   
$\mu_0$ l'intercept moyen  
$\mu_1$ la pente moyenne  
$\alpha_{i}$ effet spécifique dû à la modalité i du facteur D 
$\beta_{j}$ effet spécifique dû à la modalité j du facteur C 
$\gamma_{i}$ terme correctif de la pente, associé à la modalité i du facteur B
$\delta_{j}$ terme correctif de la pente, associé à la modalité j du facteur A
$U_{0k}$ l'écart de l'intercept pour le kème X par rapport à l'intercept moyen  
$\epsilon_{ijkl}$ erreur résiduelle 

$$Y_{ijkl}=\mu_0 + \mu_1*Time_{kl} + \alpha_{i} + \beta_{j}+\gamma_{i}*Time_{il}+\delta_{j}*Time_{jl} + U_{0k}+ \epsilon_{ijkl} \space\space\space\space i=1,2,3 \space\space\space\space j=1,2,3 \space\space\space\space k=1,...,20$$

# **Comparaison de modèles**
En vous aidant de l'article, formez quelques hypothèses et construirez les modèles correspondant. Ajustez et comparez ces modèles pour déterminer l'hypothèse la mieux supportée par les données. N'oubliez de standardiser les variables explicatives continues avec la fonction scale() de R par exemple. Dans le cas d'une variable année, la standardisation est un peu différente, n'utilisez pas la fonction scale(). Si year <- c(2006, 2007, ... 2021) par exemple, utilisez simplement la variable year - 2005 qui vaut (1, 2, .... 16) pour avoir toujours une variable entière, mais qui commence à 1 et ne prend plus de grandes valeurs.


Le modèle null : pas de covariable, pas d'effet aléatoire 
Modèle où on ajoute les effets aléatoires 
Modèle avec les covariables explicatives : une, l'autre, les deux 
Eventuellement tester une intéraction si elle est pertinente
Partir directement avec les effets aléatoires (prendre en compte la structuration des données)

# **Inférence et interprétation des résultats**
Sur la base du meilleur modèle, donnez les estimations des paramètres ainsi qu'une mesure de l'incertitude associée. Interprétez vos résultats.

# **Discussion**
Comparez vos résultats à ceux du papier. Sont-ils semblables ou différents? Pourquoi selon vous? Si cela vous semble pertinent, proposez des pistes d'amélioration de l'analyse.

